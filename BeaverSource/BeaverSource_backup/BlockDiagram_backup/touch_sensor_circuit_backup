{{{
#!html
<h1 >4.2 - Sensor Block</h1>
<br/>

<h3>Reading the inputs: (about the multiplexer)<br/></h3>
This block involves reading 8 inputs to the micro-controller via a multiplexer. Examples of the inputs going to the multiplexer are conductive fabric connections and touch sensitive buttons. This circuit is necessary because each sensor would take up an analog input on our microcontroller. Thus, we would require the micro-controller to have eight analog input pins. Instead of using up all the analog inputs on the microcontroller, we will use a multiplexer. The multiplexer takes in all eight of our sensors as inputs and feeds one of them through to a single analog pin on the micro-controller. We are able to select which one of the eight inputs is fed through by controlling three select lines (i.e. controlling 3 bits, which can represent up to 8 values). In other words, rather than requiring the microcontroller to have 8 analog inputs, we only need one. However, this comes at the cost of three digital outputs.<br/>
<br/>

When reading in an analog input with a micro-controller, the analog value is converted to a digital value. The accuracy of this value is dependent on how many bits are used to represent the value. For example, if 10 bits are used, the digital value will range from 0 to 1023.<br/>
<br/>
<center>---------------------------------------------------------------------------------------</center>
<br>
<br>
<h3>About the touch sensors:</h3>Two different types of touch sensors will be implemented on the glove.<br/> <br/>
<b>1. Force Sensitive Resistor:</b> When the force sensitive resistor (FSR) is not being pressed, the resistance of the component is at the maximum -- 1 mega ohm. When the device is fully pressed, the resistance drops to 2.5 kilo ohms. In the Eagle schematic below, an arbitrary resistor is connected to a supply voltage (typically, Vcc of the micro-controller) and then connected to the FSR. The FSR is then connected to ground (the two resistors are simply in series to ground). We have created a voltage divider. The voltage drop across the FSR (at the node between the resistor and the FSR) will be read by the micro-controller. When the FSR is not being pressed, it's resistance is high and most of the voltage drop occurs across it (i.e. the digital value would be near the maximum: 1023). Continuing the example: say the resistor in series with the FSR was a 2.5 kilo ohm resistor. Then, when the FSR is pressed, both resistors have the same value, and the digital value read would be half way between 0 and 1023. Based on the digital value that is read, the micro-controller will respond appropriately to the button presses.<br/>
<br>
<b>2. Conductive Fabric:</b> The conductive fabric is self-explanatory. It is exactly as it sounds: fabric that conducts electricity. It is made of nylon and is silver-plated. The fabric has been experimented with: if it is cut in approx. a 1 inch by 2 inch strip piece, then there is approx. 10 ohms of resistance between the two ends. However, the value of the resistance is not important in this case. The circuit is designed differently than the force sensitive resistor circuit. The digital value that is read in will be 0 always unless a connection between two conductive pieces of fabric is made. In other words, if we ever get a digital value when the multiplexer has a conductive fabric analog input selected, then this indicates that the connection has been made.<br/>
<br/>

<h2>4.2.1 - Block Design</h2>
<br/>
<img src="http://beaversource.oregonstate.edu/projects/44x201102/attachment/wiki/TouchSensingCircuit/sensor_block.jpg?format=raw" />

<br/><br/>
}}}
||'''Signal'''||'''Type'''||'''Description'''||
||vcc_sense_5|| Electrical || Vcc for multiplexer. Requires 2-5.5 V. Icc = 20 uA.
||mc_gnd || Electrical || Ground from the Arduino µ-controller.
||user_in || Electrical || Touch sensors implemented with conductive fabric. 0.1 ohms / in2.
||touch_data|| Electrical || Analog signal coming back from the shift register. 0-5 V.
||mux_sel|| Electrical || This signal is three (3) digital outputs from micro-controller. It is used to select between the values 0-7.[[BR]]There is an enable signal as well, but it is enable low (so we will just ignore it in order to save pins).[[BR]]The select lines will cycle at the speed of the microcontroller or less (16 MHz).


{{{
#!html

<br/>
<h2>4.2.2 - Block Design</h2>
<br/>
<img src="http://beaversource.oregonstate.edu/projects/44x201102/attachment/wiki/TouchSensingCircuit/touch_block_scerenshot.png?format=raw" width="100%" height="100%"/>
<br/>
<br/>

<h2>4.2.3 - Design Validation</h2>
<br/>
The schematic above is an example of how the "touch sensing block" will be implemented. This is not a first design, but an example simply for demonstration purposes. The touch sensing block has already been breadboarded and tested. With an IC such as a multiplexer, one must construct the circuit in real life to make sure it works as it is designed to be. The 4051D block represents the multiplexer that we will be using. All of the inputs and outputs are identical. The X0-X7 pins are the 8 inputs to the mux. The X pin on the right side is the analog signal that gets fed through to the microcontroller. The INH signal is a latch (enable low -- so just connect it to ground). The A, B and C signal are the three select lines which allow us to select between the the values 0 and 7.<br>
<br>
<u>Supply Voltage:</u><br>
The theoretical design of the touch sensor circuit must be created in strict accordance to the multiplexer datasheet. The multiplexer requires a 2-5.5V supply voltage. The VCC of the microcontroller is 5V. This will be used to supply voltage to the multiplexer. Before any connections to the microcontroller are made, the input supply voltage to the multiplexer must be tested to confirm that it is within range of the values specified on the datasheet.<br/>
<br/>
<u>Conductive Fabric:</u><br>
In the schematic above, the conductive fabric pieces are represented by the solid green squares.<br>
<br>
The conductive fabric has a very poor quality datasheet. Therefore, we were forced to validate the design by experiment. Using the 1 inch x 2 inch, 10 ohm strip mentioned previously, one end of the fabric was connected to 5V (VCC of microcontroller) and the other end connected to ground. This put a current of about 0.5 A through the fabric. As expected, the fabric heated up and began to slightly burn where the banana clips attached. To prevent this, a 10k ohm resistor is placed between Vcc and the conductive fabric "switch," and a 1k ohm resistor is placed between the switch and ground. When the conductive fabric pieces are connected, the voltage above the 1k ohm resistor is read as an analog input (this is the node that goes to the X4 input on the IC). When converted to a digital value, the value ready will be about (1/11)*1023, where 1023 is the maximum value represented by 10 bits.<br>
<br>
<u>Force Sensitive Resistor:</u><br>
In the schematic above, the force sensitive resistor (FSR) is represented by a potentiometer.<br>
From the schematic, it can be seen that the FSR is in series with a 2.5k ohm resistor. The value of this resistor was chosen because when the FSR is fully pressed, it's resistance drops to approximately 2.5k ohms. Thus, when the sensor is pressed, the microcontroller will read a value that is about (1/2)*1023. The current that will be drawn is 3.3V / 5k ohms = .6 mA.<br>
<br/>
<h2>4.2.4 - Block Testing</h2>
<br/>
There are two methods that could be used to test this block:<br>
One is to use the serial monitor of the micro-controller to observe changes to the digital values that are read in as each button is pressed or conductive fabric connection made. The second would be if the shift register and LED circuit is hooked up: then each button press should have an LED feedback response. If the LED is being lit up, then we know the micro-controller MUST be aware of the button press if it passed that information onto the shift register.
<br/><br/>

1. Use multimeter to measure <b>vreg_vcc_33</b> to <b>vreg_gnd</b> before connecting. <br>
2. Input 3.3V from voltage regulator (<b>vreg_vdd_33</b>) to pin 16 on SN54LV4051 (multiplexer). Check schematic for wiring.<br/>
3. Input GND from voltage regulator (<b>vreg_gnd</b>) to pin 7 on SN54LV4051 (multiplexer). Check schematic for wiring.<br/>
4. Test each button using either of the above methods to see that each circuit works. <br>
<br>
To further test the circuit, the voltages and currents at every pin of the microcontroller are tested in order to confirm the theoretical design.
<br/>
<br/>
<font color="#00CC00">PASS:</font> For each button press, the digital value read into the micro-controller is WITHIN the expected threshold.<br/>
<font color="#FF0000">FAIL:</font> For each button press, the digital value read into the micro-controller is NOT WITHIN the expected threshold.

<br/><br/>

<h2>4.2.5 - Bill of Materials</h2>
<br/>
}}}

|| '''Part Name''' || '''Part #''' || '''Distributor Name''' || '''Distributor Part #''' || '''Description''' || '''Cost/Unit''' || '''Total Cost''' ||
|| Multiplexer || SN74LV4051A || Digikey || 296-3828-5-ND || 8-Channel Analog Multiplexer/Demultiplexer [[BR]] Supply Voltage: 2 V ~ 5.5 V [[BR]] Supply Current: 20µA [[BR]] Operating Temperature: -40°C ~ 85°C [[BR]] Package: DIP (for final design a surface mount package will be used) || $0.52 || $0.52 ||
|| 10k Ohm Resistor ||  N/A || Tekbots || N/A || Tolerance: does not matter [[BR]] Power = 2.5 mW (approx) || $0.10 || $0.20 ||
|| 2.5k Ohm Resistor ||  N/A || Tekbots || N/A || Tolerance: does not matter [[BR]] Power = 5 mW (approx) || $0.10 || $0.60 ||
|| Conductive Fabric || N/A || Sparkfun || DEV-10055 || Conductive Fabric - 12"x13" MedTex180 [[BR]] Dimensions: 12 x 13" (304.8 x 330.2 mm) [[BR]] Surface Resistance (avg): < 5 ohms [[BR]] Temperature: -30°C ~ 90°C || $19.95 || $19.95 ||
|| Conductive Thread || N/A || Sparkfun || DEV-10867 || Conductive Thread Bobbin [[BR]] Length: 60 feet [[BR]] Material: Stainless steel fiber [[BR]] || $2.95 || $2.95 ||
|| || || || || || Total Cost = || $24.22 ||
[[BR]]
[[BR]]


== References ==
1. "SN54LV4051A 8-Channel Analog Multiplexer - Texas Instruments Product Page." Internet: [http://www.ti.com/product/sn74lv4051a SN54LV4051A 8-Channel Analog Multiplexer - Texas Instruments Product Page], [November 28, 2011]. [[BR]]
2. "SN54LV4051A - Datasheet". Internet: [http://www.ti.com/lit/ds/scls428h/scls428h.pdf SN54LV4051A Multiplexer Datasheet], [November 28th, 2011]. [[BR]]
3. "Force Sensitive Resistor - Spark Fun Product Page". Internet [http://www.sparkfun.com/products/9673 Force Sensitive Resistor - SparkFun Product Page], [November 28th, 2011]. [[BR]]
4. "Force Sensitive Resistor - Datasheet". Internet [http://www.sparkfun.com/datasheets/Sensors/Pressure/fsrguide.pdf Force Sensitive Resistor Datasheet], [November 28th, 2011]. [[BR]]
5. "Conductive Fabric - Spark Fun Product Page". Internet [http://www.sparkfun.com/products/10055 Conductive Fabric - SparkFun Product Page], [November 28th, 2011]. [[BR]]
6. "Conductive Fabric - Datasheet". Internet [http://www.sparkfun.com/datasheets/DevTools/LilyPad/medtex180.pdf Conductive Fabric - Datasheet], [November 28th, 2011]. [[BR]]
7. "Conductive Thread - Spark Fun Product Page". Internet [http://www.sparkfun.com/products/10867 Conductive Thread Bobbin - SparkFun Product Page], [November 28th, 2011]. [[BR]]
[[BR]]